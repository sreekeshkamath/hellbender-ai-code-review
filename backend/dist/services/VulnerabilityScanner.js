"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VulnerabilityScanner = void 0;
class VulnerabilityScanner {
    static detectVulnerabilities(content) {
        const lines = content.split('\n');
        const vulnerabilities = [];
        this.VULNERABILITY_PATTERNS.forEach(({ pattern, severity, type }) => {
            lines.forEach((line, index) => {
                if (pattern.test(line)) {
                    // Get surrounding context (2 lines before and after)
                    const start = Math.max(0, index - 2);
                    const end = Math.min(lines.length - 1, index + 2);
                    const contextCode = lines.slice(start, end + 1).map((l, i) => {
                        const lineNum = start + i + 1;
                        const marker = lineNum === index + 1 ? '> ' : '  ';
                        return `${marker}${lineNum.toString().padStart(4)} | ${l}`;
                    }).join('\n');
                    vulnerabilities.push({
                        line: index + 1,
                        type,
                        severity,
                        code: contextCode
                    });
                }
            });
        });
        return vulnerabilities;
    }
}
exports.VulnerabilityScanner = VulnerabilityScanner;
VulnerabilityScanner.VULNERABILITY_PATTERNS = [
    { pattern: /password\s*=/i, severity: 'high', type: 'Hardcoded credentials' },
    { pattern: /api[_-]?key\s*=/i, severity: 'high', type: 'Hardcoded API key' },
    { pattern: /secret\s*=/i, severity: 'high', type: 'Hardcoded secret' },
    { pattern: /eval\s*\(/i, severity: 'high', type: 'Code injection risk (eval)' },
    { pattern: /exec\s*\(/i, severity: 'high', type: 'Command injection risk' },
    { pattern: /innerHTML/i, severity: 'medium', type: 'XSS vulnerability' },
    { pattern: /dangerouslySetInnerHTML/i, severity: 'medium', type: 'XSS vulnerability' },
    { pattern: /sql\s*injection/i, severity: 'high', type: 'SQL injection' },
    { pattern: /SELECT.*FROM.*WHERE.*\+/i, severity: 'medium', type: 'SQL injection risk' },
    { pattern: /\.env/i, severity: 'medium', type: 'Environment file access' },
    { pattern: /process\.env/i, severity: 'low', type: 'Environment variable usage' },
    { pattern: /crypto\.createHash\('md5'/i, severity: 'medium', type: 'Weak hashing algorithm (MD5)' },
    { pattern: /Math\.random\(\)/i, severity: 'medium', type: 'Weak random number generator' },
    { pattern: /http:\/\//i, severity: 'medium', type: 'Insecure HTTP protocol' },
    { pattern: /console\.log/i, severity: 'low', type: 'Debug code left in production' },
    { pattern: /TODO/i, severity: 'low', type: 'TODO comment found' },
    { pattern: /FIXME/i, severity: 'low', type: 'FIXME comment found' },
    { pattern: /async\s+function\s+\w+\s*\([^)]*\)\s*{[^}]*await\s+[^}]+}/i, severity: 'low', type: 'Async function structure' },
    { pattern: /try\s*{[^}]*}\s*catch\s*\([^)]*\)\s*{[^}]*}/i, severity: 'low', type: 'Try-catch structure' }
];
