import { VulnerabilityScanner } from '../../services/VulnerabilityScanner';

describe('VulnerabilityScanner', () => {
  describe('detectVulnerabilities', () => {
    it('should detect hardcoded password', () => {
      const content = `const password = "secret123";`;

      const result = VulnerabilityScanner.detectVulnerabilities(content);

      expect(result).toHaveLength(1);
      expect(result[0]).toMatchObject({
        line: 1,
        type: 'Hardcoded credentials',
        severity: 'high',
      });
    });

    it('should detect eval usage', () => {
      const content = `function test() {
  eval("code");
}`;

      const result = VulnerabilityScanner.detectVulnerabilities(content);

      expect(result).toHaveLength(1);
      expect(result[0]).toMatchObject({
        line: 2,
        type: 'Code injection risk (eval)',
        severity: 'high',
      });
    });

    it('should detect console.log', () => {
      const content = `console.log("debug info");`;

      const result = VulnerabilityScanner.detectVulnerabilities(content);

      expect(result).toHaveLength(1);
      expect(result[0]).toMatchObject({
        line: 1,
        type: 'Debug code left in production',
        severity: 'low',
      });
    });

    it('should provide context with surrounding lines', () => {
      const content = `line1
password = "secret"
line3`;

      const result = VulnerabilityScanner.detectVulnerabilities(content);

      expect(result).toHaveLength(1);
      expect(result[0].code).toContain('line1');
      expect(result[0].code).toContain('password = "secret"');
      expect(result[0].code).toContain('line3');
    });

    it('should return empty array for clean code', () => {
      const content = `function hello() {
  return "world";
}`;

      const result = VulnerabilityScanner.detectVulnerabilities(content);

      expect(result).toHaveLength(0);
    });
  });
});